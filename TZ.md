# Техническое задание

## 1. Общая информация

**Название проекта:** Smart Food Constructor / Recipe Finder  
**Описание:** Веб-приложение на Django для поиска рецептов по введённым ингредиентам с использованием Spoonacular API. Найденные рецепты сохраняются в локальную базу данных и доступны для просмотра в каталоге. Пользователь может создавать свои рецепты, загружать изображения, добавлять рецепты в избранное, а также управлять профилем.

## 2. Технологический стек

- **Backend:** Django (Python)
- **Frontend:** HTML templates, Tailwind CSS, HTMX/Alpine
- **База данных:** SQLite (dev) / MYSQL (prod)
- **Хранение изображений:** Django `MEDIA` (ImageField) + поддержка `image_url` (для API)

## 3. Роли и права

### 3.1 Гость (неавторизованный)
- Может видеть главную страницу поиска
- Может просматривать каталог рецептов
- Может открывать детальную страницу рецепта
- Не может добавлять в избранное
- Не может создавать/редактировать/удалять рецепты

### 3.2 Пользователь (авторизованный)
- Всё из “Гость”
- Может добавлять/удалять рецепты из избранного
- Может создавать рецепты, редактировать и удалять свои рецепты
- Может просматривать список “мои рецепты”
- Может редактировать профиль

## 4. Функциональные требования

### 4.1 Главная страница: поиск рецептов по ингредиентам (Spoonacular)
**URL:** `/`  
**Форма:**
- Поле ввода `ingredients` (строка, разделитель запятая)
- POST отправка формы
- Валидация: поле не пустое

**Логика:**
- Введённая строка очищается: пробелы убираются, пустые элементы отбрасываются
- Формируется строка формата `ingredient1,ingredient2,ingredient3`
- Выполняется запрос к Spoonacular endpoint `findByIngredients`
- Для каждого результата запрашиваются детали рецепта через `/{id}/information`
- Рецепты импортируются/обновляются в локальной БД через сервис импорта (по `external_id`)
- На странице отображаются карточки результатов, где для каждого рецепта показываются:
  - рецепт
  - список `used_ingredients`
  - список `missed_ingredients`
  - список `unused_ingredients`

**Отображение изображения:**
- Если у рецепта есть загруженное изображение (`image`) — показывать его
- Иначе показывать `image_url` (из API)
- Иначе выводить “No image”

---

### 4.2 Каталог рецептов (локальная БД)
**URL:** `/recipes/`  
**Функциональность:**
- Отображение списка рецептов, сохранённых в БД
- Поддержка поиска/фильтрации через форму фильтрации

---

### 4.3 Детальная страница рецепта
**URL:** `/recipes/<id>/`  
**Функциональность:**
- Отображение полной информации о рецепте:
  - название
  - изображение
  - времена (`cooking_time`, `prep_time`)
  - порции (`servings`)
  - сложность (`difficulty`)
  - описание (`description`)
  - инструкции (`instructions`)
  - категории и ингредиенты

---

### 4.4 Пользовательские рецепты (CRUD)
**Создание:** `/recipes/create/`  
**Редактирование:** `/recipes/<id>/edit/`  
**Удаление:** `/recipes/<id>/delete/`  
**Мои рецепты:** `/accounts/profile/recipes`

**Функциональность:**
- Пользователь может создать рецепт вручную
- Поля рецепта:
  - `title`
  - `description` (опционально)
  - `image` (опционально, загрузка файла)
  - `cooking_time`
  - `prep_time` (опционально)
  - `servings` (опционально)
  - `difficulty` (опционально)
  - `instructions` (опционально)
  - категории
- Для “моих рецептов” выводится список рецептов, принадлежащих текущему пользователю

**Правила доступа:**
- Создавать — только авторизованный
- Редактировать/удалять — только автор рецепта

---

### 4.5 Избранное
**Список избранного:** `/favorites/`  
**Переключение избранного (toggle):** `/favorites/<recipe_id>/toggle/` (POST)

**Функциональность:**
- Авторизованный пользователь может добавлять/удалять рецепт из избранного
- В списке избранного показываются рецепты, отмеченные пользователем
- Дубликаты запрещены (уникальность user+recipe)

---

### 4.6 Аутентификация и профиль
**Регистрация:** отдельная страница/роут (users app)  
**Логин/логаут:** стандартная авторизация Django  
**Профиль:** страница профиля пользователя

**Функциональность профиля:**
- Создаётся `Profile` автоматически при создании `User`
- Можно обновить аватар
- Можно обновить данные пользователя

---

## 5. Интеграция с Spoonacular API

### 5.1 Используемые endpoints
- `GET /recipes/findByIngredients`
  - параметры: `ingredients`, `number`, `ranking`, `ignorePantry`, `apiKey`
- `GET /recipes/<id>/information`
  - параметры: `apiKey`

### 5.2 Импорт в базу
- Рецепт сохраняется/обновляется по `external_id`
- Сохраняются:
  - базовые поля рецепта
  - категории (`dishTypes` → `Category` + `RecipeCategory`)
  - ингредиенты (`extendedIngredients` → `Ingredient` + `RecipeIngredient`)

---

## 6. Архитектура и база данных

### 6.1 Схема базы данных

### **Users**

* id
* email
* username
* password
* created_at
* updated_at

### **Recipes**

* id
* title
* description
* image
* source (spoonacular / user)
* external_id
* cooking_time
* prep_time
* servings
* difficulty
* instructions
* created_at
* updated_at
* user_id (nullable)

### **Categories**

* id
* name
* slug

### **Recipe_Categories**

* recipe_id
* category_id

### **Ingredients**

* id
* name
* image

### **Recipe_Ingredients**

* id
* recipe_id
* ingredient_id
* quantity
* unit
* description

### **User_Favorites**

* id
* user_id
* recipe_id
* created_at

### **User_Ingredients (Холодильник)**

* id
* user_id
* ingredient_id
* quantity
* unit
* added_at

---

## 7. Инфраструктура

### 7.1 Docker

**Контейнеры:**

* Django Application
* MySQL
* Nginx

**docker-compose.yml включает:**

* Volumes
* Networking
* Environment variables
* Port mapping

---

### 7.2 Nginx

* Раздача статических файлов
* Раздача медиа файлов
* Reverse Proxy к Django
* Gzip сжатие
* Security Headers
* Подготовка к SSL/TLS

---

## 8. Конфигурация окружения

### Переменные окружения:

* `SECRET_KEY`
* `DEBUG`
* `ALLOWED_HOSTS`
* `DATABASE_*`
* `SPOONACULAR_API_KEY`



## 9. Нефункциональные требования

- Код разделён по приложениям (`recipes`, `ingredients`, `favorites`, `users`)
- Внешняя интеграция вынесена в сервис/импортёр (не в шаблоны)
- Обработка ошибок API: если Spoonacular недоступен, приложение должно возвращать пустой список результатов без падения страницы

---

## 10. Структура проекта

- `apps/recipes` — рецепты, поиск, импорт, CRUD, шаблоны рецептов
- `apps/favorites` — избранное
- `apps/users` — регистрация/профиль
- `apps/ingredients` — ингредиенты (модель + заготовки view/forms/templates)
- `templates/` — базовые шаблоны
- `static/` — статические файлы